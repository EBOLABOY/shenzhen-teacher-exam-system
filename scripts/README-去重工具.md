# 题目去重工具使用说明

## 🎯 问题背景

用户反馈在刷题达到1000道以后，经常出现重复题目。为了解决这个问题，我们开发了一套完整的去重工具。

## 🛠️ 可用工具

### 1. 基础检查工具

#### `npm run check-duplicates`
- **功能**: 全面检查数据库中的重复题目
- **特点**: 
  - 分批获取所有题目，避免内存问题
  - 分别检查前1000道和1000道以后的重复情况
  - 提供详细的重复分析报告

#### `npm run check-after-1000`
- **功能**: 专门检查1000道以后题目的重复情况
- **特点**:
  - 重点关注1000道以后的题目
  - 检查与前1000道的重复
  - 检查1000道以后内部的重复
  - 提供重复来源分析

### 2. 去重处理工具

#### `npm run remove-duplicates-after-1000`
- **功能**: 模拟删除1000道以后的重复题目
- **特点**:
  - 安全的模拟运行，不会实际删除
  - 显示将要删除的题目列表
  - 提供删除统计信息

#### `npm run remove-duplicates-after-1000-real`
- **功能**: 实际删除1000道以后的重复题目
- **特点**:
  - ⚠️ **危险操作** - 会实际删除题目
  - 自动处理相关的用户答题记录和错题记录
  - 分批删除，避免数据库压力

### 3. 完整去重工具

#### `npm run deduplicate`
- **功能**: 交互式的完整去重工具
- **特点**:
  - 使用相似度算法检测重复
  - 交互式操作，用户可选择操作类型
  - 安全的数据迁移机制

## 📋 使用步骤

### 第一步：检查重复情况
```bash
# 检查1000道以后的重复情况
npm run check-after-1000
```

### 第二步：模拟删除（安全）
```bash
# 模拟删除，查看将要删除的题目
npm run remove-duplicates-after-1000
```

### 第三步：实际删除（谨慎）
```bash
# 实际删除重复题目
npm run remove-duplicates-after-1000-real
```

## ⚠️ 安全注意事项

1. **备份数据**: 在执行实际删除前，建议备份数据库
2. **先模拟**: 总是先运行模拟删除，确认要删除的题目
3. **检查结果**: 删除后运行检查工具确认结果
4. **用户数据**: 工具会自动处理相关的用户答题记录

## 🔍 去重逻辑

### 重复判断标准
- **完全重复**: 题目内容和答案完全相同
- **保留策略**: 保留ID较小的题目（通常是较早导入的）
- **数据迁移**: 将重复题目的用户记录转移或删除

### 处理优先级
1. 删除与前1000道重复的题目
2. 删除1000道以后内部重复的题目
3. 保护用户数据完整性

## 📊 预期效果

- **减少重复**: 显著减少用户遇到重复题目的概率
- **提升体验**: 用户可以练习更多不同的题目
- **数据清洁**: 保持数据库的整洁和高效

## 🚀 系统优化

除了去重工具，系统还进行了以下优化：

1. **智能选题算法**: 使用Fisher-Yates洗牌算法
2. **避重机制**: 自动排除用户已做过的题目
3. **进度管理**: 提供进度重置功能
4. **完成提示**: 当所有题目完成时的友好提示

## 📞 技术支持

如果在使用过程中遇到问题：
1. 检查环境变量配置（.env.local）
2. 确认数据库连接正常
3. 查看控制台错误信息
4. 联系技术支持

---

**最后更新**: 2024年12月
**版本**: v1.0.0
